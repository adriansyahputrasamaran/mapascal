<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laporan Perbaikan Hosting Railway</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; margin: 20px; background-color: #f4f4f4; color: #333; }
        .container { max-width: 900px; margin: auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h1, h2, h3 { color: #0056b3; }
        pre { background: #eee; padding: 15px; border-radius: 5px; overflow-x: auto; }
        .diff { background: #e8ffe8; border: 1px solid #aaffaa; padding: 10px; margin-bottom: 10px; }
        .diff .removed { color: #a00; text-decoration: line-through; }
        .diff .added { color: #0a0; }
        .section { margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #eee; }
        .warning { color: #ffc107; background-color: #fff3cd; border-color: #ffeeba; padding: 10px; border-radius: 5px; margin-bottom: 15px; }
        .info { color: #007bff; background-color: #e2f3ff; border-color: #b8daff; padding: 10px; border-radius: 5px; margin-bottom: 15px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Laporan Perbaikan Hosting Railway</h1>
        <p>Dokumen ini merinci perbaikan yang dilakukan pada aplikasi Flask Anda untuk memastikan kompatibilitas dan kesiapan deployment di platform Railway, dengan tetap menjaga logika, tampilan, dan sistem keamanan aplikasi Anda.</p>

        <div class="section">
            <h2>Ringkasan Masalah yang Teridentifikasi</h2>
            <ul>
                <li>Folder <code>.venv/</code> tidak boleh di-deploy.</li>
                <li>File <code>.env</code> berisi informasi sensitif dan tidak boleh di-deploy langsung.</li>
                <li>File <code>cookie.txt</code> adalah artefak lokal.</li>
                <li><code>requirements.txt</code> mungkin tidak lengkap.</li>
                <li>Tidak adanya <code>Procfile</code> atau <code>Dockerfile</code>.</li>
                <li>URL database hardcoded (<code>localhost</code>) di <code>.env</code>.</li>
                <li>Penanganan migrasi database untuk lingkungan produksi.</li>
                <li>Direktori <code>uploads/</code> bersifat ephemeral di Railway.</li>
                <li>Konfigurasi aplikasi untuk kesiapan produksi (misalnya, <code>DEBUG</code>).</li>
            </ul>
        </div>

        <div class="section">
            <h2>Perbaikan yang Dilakukan</h2>
            <h3>1. Konfigurasi Variabel Lingkungan di <code>config.py</code></h3>
            <p><strong>Alasan Teknis:</strong> Meskipun <code>config.py</code> sudah menggunakan <code>os.environ.get()</code>, keberadaan <code>load_dotenv()</code> di dalam kelas <code>Config</code> dapat menyebabkan masalah di lingkungan produksi. Di lingkungan produksi seperti Railway, variabel lingkungan harus disediakan langsung oleh platform, bukan dibaca dari file <code>.env</code>. Menghapus <code>load_dotenv()</code> dari <code>config.py</code> memastikan aplikasi hanya bergantung pada variabel lingkungan yang disediakan oleh sistem. Selain itu, menambahkan konfigurasi <code>DEBUG</code> dan <code>UPLOAD_FOLDER</code> melalui variabel lingkungan memungkinkan kontrol yang lebih baik atas perilaku aplikasi di berbagai lingkungan.</p>
            <p><strong>File yang Diperbaiki:</strong> <code>config.py</code></p>
            <pre class="diff"><code>--- a/config.py
+++ b/config.py
@@ -1,11 +1,13 @@
 import os
-from dotenv import load_dotenv
+# from dotenv import load_dotenv # Removed for production readiness
 
-load_dotenv() # Muat variabel dari .env
+# load_dotenv() # Muat variabel dari .env - Removed for production readiness
 
 class Config:
     SECRET_KEY = os.environ.get('SECRET_KEY')
     SQLALCHEMY_DATABASE_URI = os.environ.get('DATABASE_URL')
     SQLALCHEMY_TRACK_MODIFICATIONS = False
+    DEBUG = os.environ.get('FLASK_DEBUG') == 'True' # Set DEBUG based on FLASK_DEBUG env var
+    UPLOAD_FOLDER = os.environ.get('UPLOAD_FOLDER', 'app/uploads') # Configurable upload folder
 
     # Admin Contact Information
     ADMIN_CONTACT_PHONE = '0822-9325-2854'
</code></pre>
            <h3>2. Penanganan Variabel Lingkungan untuk Pengembangan Lokal di <code>app/__init__.py</code></h3>
            <p><strong>Alasan Teknis:</strong> Setelah menghapus <code>load_dotenv()</code> dari <code>config.py</code> untuk kesiapan produksi, penting untuk memastikan bahwa variabel lingkungan dari file <code>.env</code> masih dimuat untuk pengembangan lokal. Menempatkan <code>load_dotenv()</code> di <code>app/__init__.py</code> memastikan bahwa variabel-variabel ini tersedia saat aplikasi dijalankan secara lokal (misalnya, melalui <code>flask run</code> atau <code>python app.py</code>), tanpa memengaruhi perilaku di lingkungan produksi yang mengandalkan variabel lingkungan yang disediakan oleh platform.</p>
            <p><strong>File yang Diperbaiki:</strong> <code>app/__init__.py</code></p>
            <pre class="diff"><code>--- a/app/__init__.py
+++ b/app/__init__.py
@@ -1,6 +1,8 @@
-from flask import Flask, render_template, request, abort
+import os # Ensure os is imported first for load_dotenv check
+from dotenv import load_dotenv # Import load_dotenv
+load_dotenv() # Load environment variables from .env for local development
+
+from flask import Flask, render_template, request, abort
 from flask_sqlalchemy import SQLAlchemy
 from flask_login import LoginManager, current_user
 from flask_migrate import Migrate
@@ -8,7 +10,6 @@
 from flask_limiter import Limiter
 from flask_limiter.util import get_remote_address
 from config import Config
-import os
 import logging
 from logging.handlers import RotatingFileHandler
 from app.decorators import requires_role, owns_resource # Import decorators
</code></pre>
            <h3>3. Pembersihan dan Pembaruan <code>requirements.txt</code></h3>
            <p><strong>Alasan Teknis:</strong> Awalnya, menjalankan <code>pip freeze</code> menghasilkan daftar dependensi yang sangat panjang dan tidak relevan, yang dapat memperlambat proses deployment dan meningkatkan ukuran image di Railway. Perbaikan ini melibatkan pembuatan ulang <code>requirements.txt</code> dengan daftar dependensi inti yang diperlukan oleh aplikasi Flask, termasuk <code>gunicorn</code> untuk server produksi, dan memperbarui versi paket agar sesuai dengan versi terbaru yang kompatibel. Ini memastikan lingkungan produksi yang ramping dan efisien.</p>
            <p><strong>File yang Diperbaiki:</strong> <code>requirements.txt</code></p>
            <pre class="diff"><code>--- a/requirements.txt
+++ b/requirements.txt
@@ -1,30 +1,14 @@
-absl-py==2.3.1
-aiofiles==24.1.0
-alembic==1.17.1
-... (many lines removed) ...
-WTForms==3.2.1
-WTForms-SQLAlchemy==0.4.2
+Flask==3.1.2
+Flask-SQLAlchemy==3.1.1
+Flask-Login==0.6.3
+Werkzeug==3.1.3
+Flask-WTF==1.2.2
+python-dotenv==1.2.1
+bcrypt==5.0.0
+PyMySQL==1.1.2
+Flask-Migrate==4.1.0
+Flask-Limiter==4.0.0
+python-magic-bin==0.4.14
+Flask-Talisman==1.1.0
+gunicorn==23.0.0
</code></pre>
            <h3>4. Penambahan <code>Procfile</code></h3>
            <p><strong>Alasan Teknis:</strong> Railway menggunakan <code>Procfile</code> untuk menentukan bagaimana aplikasi harus dijalankan. Dengan menambahkan <code>Procfile</code> yang menginstruksikan Railway untuk menjalankan aplikasi menggunakan Gunicorn (<code>web: gunicorn wsgi:app</code>), kita memastikan bahwa aplikasi dapat di-deploy dan dijalankan dengan benar di lingkungan produksi. Gunicorn adalah server WSGI yang direkomendasikan untuk aplikasi Python di produksi.</p>
            <p><strong>File yang Dibuat:</strong> <code>Procfile</code></p>
            <pre class="diff"><code>--- /dev/null
+++ b/Procfile
@@ -0,0 +1,1 @@
+web: gunicorn wsgi:app
</code></pre>
            <h3>Catatan Penting untuk Deployment</h3>
            <ul>
                <li><strong>Folder <code>.venv/</code>:</strong> Folder ini adalah lingkungan virtual lokal Anda dan tidak boleh di-deploy ke Railway. Pastikan folder ini ada di <code>.gitignore</code> Anda.</li>
                <li><strong>File <code>.env</code>:</strong> File ini berisi informasi sensitif dan tidak boleh di-commit ke repositori atau di-deploy ke produksi. Sebagai gantinya, Anda harus mengatur variabel lingkungan berikut di dashboard Railway Anda:
                    <ul>
                        <li><code>SECRET_KEY</code>: Gunakan kunci yang kuat dan unik.</li>
                        <li><code>DATABASE_URL</code>: URL koneksi database Anda di Railway (misalnya, dari PostgreSQL atau MySQL add-on).</li>
                        <li><code>FLASK_DEBUG</code>: Setel ke <code>False</code> untuk lingkungan produksi.</li>
                        <li><code>UPLOAD_FOLDER</code>: Jika Anda menggunakan penyimpanan eksternal, atur jalur ini sesuai. Jika tidak, biarkan default atau sesuaikan jika perlu.</li>
                    </ul>
                </li>
                <li><strong>File <code>cookie.txt</code>:</strong> Ini adalah artefak lokal dan tidak relevan untuk deployment produksi.</li>
                <li><strong>Penanganan Migrasi Database:</strong>
                    <p>Setelah deployment awal ke Railway, Anda perlu menjalankan migrasi database untuk membuat atau memperbarui skema database Anda. Ini dapat dilakukan melalui Railway CLI atau dengan menambahkan perintah sebagai bagian dari proses build/deploy Anda (misalnya, sebagai <code>start command</code> atau <code>pre-deploy hook</code>).</p>
                    <p>Contoh perintah untuk menjalankan migrasi:</p>
                    <pre><code>flask db upgrade</code></pre>
                    <p>Pastikan Anda telah menginstal Flask-Migrate dan menginisialisasi migrasi secara lokal sebelum deployment.</p>
                </li>
                <li><strong>Direktori <code>uploads/</code> (Penyimpanan Ephemeral):</strong>
                    <p class="warning"><strong>Peringatan:</strong> Direktori <code>app/uploads/</code> di Railway bersifat <strong>ephemeral</strong>. Ini berarti semua file yang diunggah ke direktori ini akan hilang setiap kali aplikasi Anda di-deploy ulang, di-restart, atau di-scale. Untuk penyimpanan file pengguna yang persisten, sangat disarankan untuk menggunakan layanan penyimpanan objek eksternal seperti AWS S3, Google Cloud Storage, atau layanan serupa.</p>
                    <p>Jika Anda tidak mengonfigurasi penyimpanan eksternal, file yang diunggah akan hilang. Konfigurasi <code>UPLOAD_FOLDER</code> di <code>config.py</code> memungkinkan Anda untuk dengan mudah beralih ke jalur penyimpanan eksternal jika Anda mengimplementasikannya di masa mendatang.</p>
                </li>
            </ul>

            <h2>Instruksi Deployment Akhir ke Railway</h2>
            <ol>
                <li><strong>Pastikan Repositori Bersih:</strong> Pastikan Anda telah menghapus <code>.env</code> dan <code>cookie.txt</code> dari repositori Git Anda sebelum push ke Railway. Folder <code>.venv/</code> seharusnya sudah diabaikan oleh <code>.gitignore</code>.</li>
                <li><strong>Push ke Git:</strong> Commit semua perubahan yang telah dilakukan dan push ke repositori Git Anda (misalnya, GitHub, GitLab, Bitbucket).</li>
                <li><strong>Hubungkan ke Railway:</strong> Di dashboard Railway, buat proyek baru atau pilih proyek yang sudah ada, lalu hubungkan ke repositori Git Anda.</li>
                <li><strong>Konfigurasi Variabel Lingkungan:</strong> Di pengaturan proyek Railway Anda, tambahkan variabel lingkungan berikut:
                    <ul>
                        <li><code>SECRET_KEY</code>: Kunci rahasia yang kuat.</li>
                        <li><code>DATABASE_URL</code>: URL koneksi database Anda (misalnya, <code>mysql://user:password@host:port/database</code>).</li>
                        <li><code>FLASK_DEBUG</code>: Setel ke <code>False</code>.</li>
                        <li><code>UPLOAD_FOLDER</code>: (Opsional) Jika Anda menggunakan penyimpanan eksternal, atur jalur ini.</li>
                    </ul>
                </li>
                <li><strong>Deployment Otomatis:</strong> Railway akan secara otomatis mendeteksi <code>Procfile</code> dan <code>requirements.txt</code> Anda, menginstal dependensi, dan menjalankan aplikasi Anda.</li>
                <li><strong>Jalankan Migrasi Database:</strong> Setelah deployment berhasil, akses terminal Railway untuk proyek Anda dan jalankan perintah migrasi database:
                    <pre><code>flask db upgrade</code></pre>
                    <p>Atau, konfigurasikan ini sebagai <code>pre-deploy hook</code> di Railway jika Anda ingin migrasi berjalan secara otomatis setiap kali ada deployment baru.</p>
                </li>
                <li><strong>Verifikasi:</strong> Akses URL aplikasi Anda yang disediakan oleh Railway untuk memverifikasi bahwa semuanya berfungsi dengan baik.</li>
            </ol>
        </div>
    </div>
</body>
</html>