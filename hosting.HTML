<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panduan Setup Database Railway</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 20px auto;
            padding: 0 15px;
            background-color: #f4f4f4;
        }
        h1, h2, h3, h4 {
            color: #0056b3;
        }
        pre {
            background-color: #eee;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        code {
            font-family: "Courier New", Courier, monospace;
            background-color: #e9e9e9;
            padding: 2px 4px;
            border-radius: 3px;
        }
        strong {
            color: #000;
        }
        hr {
            border: 0;
            height: 1px;
            background: #ccc;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>Panduan Setup Database Railway untuk Aplikasi MAPASCAL</h1>

    <p>Masalah yang Anda hadapi sangat umum terjadi saat pertama kali memindahkan aplikasi dari komputer lokal ke layanan hosting seperti Railway.</p>

    <p>Singkatnya, <strong>iya, masalah login ini disebabkan karena database di Railway belum diatur.</strong></p>

    <h2>Berikut penjelasannya:</h2>
    <ol>
        <li>
            <strong>Aplikasi Terisolasi:</strong> Saat Anda deploy ke Railway, aplikasi Anda berjalan di lingkungan yang benar-benar baru dan terpisah. Aplikasi tersebut tidak bisa melihat file <code>mapascal_db.sql</code> atau database apa pun yang ada di komputer lokal Anda.
        </li>
        <li>
            <strong>Database Kosong:</strong> Railway memang mengharuskan Anda membuat layanan database baru untuk aplikasi Anda. Saat ini, aplikasi Anda di Railway kemungkinan besar berjalan tanpa database atau terhubung ke database kosong. Karena databasenya kosong, data admin yang Anda buat di lokal tidak ada di sana. Itulah sebabnya login selalu gagal.
        </li>
        <li>
            <strong>Impor Database:</strong> Anda benar, solusinya adalah memasukkan data Anda ke database Railway. Anda <strong>bisa</strong> mengimpor file <code>.sql</code> Anda, tetapi prosesnya sedikit berbeda.
        </li>
    </ol>

    <hr>

    <h2>Cara Mengatasi Masalah Ini (Langkah demi Langkah)</h2>
    <p>Mari kita atur database Anda di Railway.</p>

    <h3>Langkah 1: Buat Database di Railway</h3>
    <ol>
        <li>Buka proyek Anda di dasbor Railway.</li>
        <li>Klik tombol <strong>"+ New"</strong> atau <strong>"Add a new service"</strong>.</li>
        <li>Pilih <strong>"Database"</strong>.</li>
        <li>Pilih salah satu, misalnya <strong>"PostgreSQL"</strong> atau <strong>"MySQL"</strong>. (Saya sarankan <strong>PostgreSQL</strong> karena umumnya lebih mudah dikonfigurasi untuk production).</li>
    </ol>
    <p>Setelah Anda membuatnya, Railway akan memberikan Anda sebuah "Connection URL" atau "Database URL". Ini adalah alamat untuk database baru Anda.</p>

    <h3>Langkah 2: Hubungkan Aplikasi Anda ke Database Baru</h3>
    <ol>
        <li>Di dasbor Railway, buka layanan aplikasi Flask Anda (bukan database yang baru dibuat).</li>
        <li>Pergi ke tab <strong>"Variables"</strong>.</li>
        <li>Cari variabel yang bernama <code>SQLALCHEMY_DATABASE_URI</code>. Jika tidak ada, buat variabel baru dengan nama itu.</li>
        <li>Salin "Connection URL" dari database PostgreSQL/MySQL yang Anda buat tadi, dan tempelkan sebagai nilai untuk variabel <code>SQLALCHEMY_DATABASE_URI</code>.
            <ul>
                <li><strong>Penting:</strong> Jika Anda menggunakan PostgreSQL, URL koneksi dari Railway mungkin dimulai dengan <code>postgres://</code>. Flask-SQLAlchemy terkadang memerlukan <code>postgresql://</code>. Jika koneksi gagal, coba ganti <code>postgres://</code> menjadi <code>postgresql://</code>.</li>
            </ul>
        </li>
    </ol>
    <p>Setelah Anda menyimpan variabel ini, Railway akan secara otomatis me-restart aplikasi Anda dengan koneksi database yang baru. Namun, database ini masih kosong.</p>

    <h3>Langkah 3: Impor Struktur dan Data Database Anda</h3>
    <p>Ini adalah langkah terpenting. Ada dua cara utama:</p>

    <h4>Opsi A: (Lebih Mudah) Menjalankan Migrasi dan Script Admin</h4>
    <p>Ini cara yang paling bersih dan disarankan.</p>
    <ol>
        <li>
            <strong>Buka Shell Aplikasi:</strong> Di layanan aplikasi Anda di Railway, pergi ke tab <strong>"Deployments"</strong>, klik deployment terbaru Anda, lalu pilih tab <strong>"Tools"</strong> dan klik <strong>"Shell"</strong> atau <strong>"Bash"</strong>.
        </li>
        <li>
            <strong>Jalankan Migrasi Database:</strong> Di dalam shell tersebut, jalankan perintah <code>flask db upgrade</code>. Perintah ini akan membuat semua tabel (users, surat, dll.) sesuai dengan model yang ada di kode Anda.
            <pre><code>flask db upgrade</code></pre>
        </li>
        <li>
            <strong>Buat User Admin:</strong> Setelah tabel dibuat, jalankan skrip yang sudah ada untuk membuat admin.
            <pre><code>python create_or_update_admin.py</code></pre>
            <p>Skrip ini akan membuat pengguna admin di database production Anda. Setelah ini selesai, Anda seharusnya bisa login dengan username dan password admin Anda.</p>
        </li>
    </ol>

    <h4>Opsi B: (Agak Rumit) Impor Langsung File <code>.sql</code></h4>
    <p>Jika Anda ingin semua data (bukan hanya admin) dari database lokal Anda dipindahkan, Anda bisa melakukan ini.</p>
    <ol>
        <li>
            <strong>Dapatkan Kredensial Database:</strong> Di layanan database Railway Anda, pergi ke tab <strong>"Connect"</strong>. Di sana Anda akan menemukan semua informasi (host, port, username, password, nama database).
        </li>
        <li>
            <strong>Gunakan SQL Client:</strong> Gunakan aplikasi SQL client di komputer Anda (seperti DBeaver, TablePlus, atau bahkan command line <code>psql</code> atau <code>mysql</code>) untuk terhubung ke database Railway menggunakan kredensial di atas.
        </li>
        <li>
            <strong>Impor File:</strong> Setelah terhubung, Anda bisa menjalankan query dari file <code>mapascal_db.sql</code> Anda di dalam SQL client tersebut untuk mengimpor semua data.
        </li>
    </ol>

    <hr>

    <p><strong>Rekomendasi saya adalah coba Opsi A terlebih dahulu.</strong> Itu adalah cara yang paling standar untuk menyiapkan aplikasi Flask di lingkungan produksi.</p>

    <p>Silakan coba langkah-langkah tersebut, dan jika Anda mengalami kesulitan di salah satu langkah, beri tahu saya di mana kesulitannya.</p>
</body>
</html>